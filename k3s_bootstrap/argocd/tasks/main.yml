---
- name: Create TLS certificates for ArgoCD
  kubernetes.core.k8s:
    definition:
      apiVersion: cert-manager.io/v1
      kind: Certificate
      metadata:
        name: argocd-server-tls
        namespace: argocd
      spec:
        secretName: argocd-server-tls
        duration: 2160h
        renewBefore: 360h
        subject:
          organizations:
            - argocd
        dnsNames:
          - argocd.{{ ipaserver_domain }}
        issuerRef:
          name: internal-acme-issuer
          kind: ClusterIssuer
    kubeconfig: "{{ homelab_data_path }}/kubeconfig"
